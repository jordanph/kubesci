steps:
  - name: "Run tests"
    image: rust:1.42
    commands: 
      - sh
      - -c
      - cargo test

  - name: "Run linting"
    image: busybox
    branch: "!master"
    commands: 
      - sh 
      - -c 
      - echo "$HELLO_WORLD" && sleep 5
    env:
      - name: HELLO_WORLD
        value: "hello world!"

  - name: "Release"
    image: gcr.io/kaniko-project/executor:latest
    # branch: master
    args:
      - "--dockerfile=/app/Dockerfile"
      - "--context=dir:///app"
      - "--destination=jordanph/kubes-cd:latest"
    mountSecret:
      - name: docker-config
        mountPath: /kaniko/.docker/config.json
